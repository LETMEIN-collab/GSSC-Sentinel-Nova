<!DOCTYPE html>
<html><head><title>Map Shading Test</title>
<style>body{background:#0a0a0a;color:#e5e5e5;font-family:'Courier New',monospace;padding:20px;font-size:12px}
h1{color:#ff3b30;font-size:14px}.pass{color:#30d158}.fail{color:#ff3b30}.warn{color:#ffd60a}
pre{background:#111;padding:10px;border:1px solid #333;overflow:auto;max-height:400px}
button{background:#ff3b30;color:#fff;border:none;padding:8px 16px;cursor:pointer;font:bold 12px monospace;margin-bottom:12px}
</style></head><body>
<h1>SENTINEL NOVA — MAP SHADING DIAGNOSTIC</h1>
<button onclick="runTest()">▶ RUN TEST</button>
<div id="out"></div>
<script>
var ADV_COUNTRIES = [
  'Afghanistan','Ukraine','Russia','Syria','Iran','Iraq','Yemen','Somalia','Sudan',
  'South Sudan','Libya','Mali','Haiti','North Korea','Venezuela','Myanmar (Burma)',
  'Burkina Faso','Niger','Central African Republic','Belarus','Lebanon','Gaza Strip',
  'Pakistan','Nigeria','Honduras','El Salvador','Ethiopia',
  'Democratic Republic of the Congo','Cameroon','Chad','Mauritania','Guinea',
  'Colombia','Kenya','Mexico','Brazil','Egypt','Turkey','India','Israel',
  'Philippines','South Africa','Jamaica','China'
];

var ADV_TO_GEO = {
  'myanmar (burma)':'Myanmar','gaza strip':'Palestine','north korea':'North Korea',
  'democratic republic of the congo':'Democratic Republic of the Congo',
  'central african republic':'Central African Republic','south sudan':'South Sudan',
  'burkina faso':'Burkina Faso','el salvador':'El Salvador','south africa':'South Africa'
};

function runTest(){
  var out = document.getElementById('out');
  out.innerHTML = '<p class="warn">Fetching GeoJSON from MAIN branch...</p>';

  // Test both URLs
  var urls = [
    {label:'main branch', url:'https://raw.githubusercontent.com/datasets/geo-countries/main/data/countries.geojson'},
    {label:'master branch', url:'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson'}
  ];

  urls.forEach(function(u){
    fetch(u.url).then(function(r){
      out.innerHTML += '<p>'+u.label+': HTTP '+r.status+' '+(r.ok?'<span class="pass">OK</span>':'<span class="fail">FAILED</span>')+'</p>';
      if(!r.ok) return;
      return r.json().then(function(geo){
        out.innerHTML += '<p class="pass">GeoJSON loaded: '+geo.features.length+' features</p>';

        // Check property keys
        var f0 = geo.features[0].properties;
        out.innerHTML += '<p>Property keys: '+Object.keys(f0).join(', ')+'</p>';
        out.innerHTML += '<p>First feature: name="'+(f0.name||'MISSING')+'" ADMIN="'+(f0.ADMIN||'MISSING')+'"</p>';

        // Get all GeoJSON names
        var geoNames = {};
        geo.features.forEach(function(f){
          var n = f.properties.name || f.properties.ADMIN || '';
          geoNames[n.toLowerCase()] = n;
        });

        // Match each advisory country
        var html = '<h2>Advisory → GeoJSON Matching</h2><pre>';
        var matched = 0, missed = 0;
        ADV_COUNTRIES.forEach(function(c){
          var cl = c.toLowerCase();
          // Direct
          if(geoNames[cl]){
            html += '<span class="pass">✓ '+c+' → "'+geoNames[cl]+'"</span>\n';
            matched++;
            return;
          }
          // Via alias
          var alias = ADV_TO_GEO[cl];
          if(alias && geoNames[alias.toLowerCase()]){
            html += '<span class="pass">✓ '+c+' → "'+geoNames[alias.toLowerCase()]+'" (via alias)</span>\n';
            matched++;
            return;
          }
          // Fuzzy
          var found = false;
          for(var key in geoNames){
            if(key.length>4 && cl.length>4 && (key.indexOf(cl)!==-1 || cl.indexOf(key)!==-1)){
              html += '<span class="warn">~ '+c+' → "'+geoNames[key]+'" (fuzzy)</span>\n';
              matched++;
              found = true;
              break;
            }
          }
          if(!found){
            html += '<span class="fail">✗ '+c+' — NO MATCH</span>\n';
            missed++;
          }
        });
        html += '</pre>';
        html += '<p><b>Result: <span class="'+(missed===0?'pass':'fail')+'">'+matched+'/'+ADV_COUNTRIES.length+' matched, '+missed+' missed</span></b></p>';

        // Show all GeoJSON names for debugging
        html += '<h2>All GeoJSON Country Names ('+Object.keys(geoNames).length+')</h2><pre>';
        Object.values(geoNames).sort().forEach(function(n){ html += n + '\n'; });
        html += '</pre>';

        out.innerHTML += html;
      });
    }).catch(function(e){
      out.innerHTML += '<p class="fail">'+u.label+': ERROR — '+e.message+'</p>';
    });
  });
}
</script>
</body></html>
